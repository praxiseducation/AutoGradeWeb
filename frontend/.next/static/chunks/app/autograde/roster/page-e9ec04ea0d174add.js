(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[549],{8809:function(e,s,t){Promise.resolve().then(t.bind(t,5467))},5467:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return RosterPage}});var a=t(7437),l=t(2265),r=t(4033),n=t(5606),d=t(4501);function CSVUploader(e){let{periodId:s,onSuccess:t,onCancel:r}=e,[n,i]=(0,l.useState)(null),[o,c]=(0,l.useState)(null),[u,m]=(0,l.useState)({}),[x,p]=(0,l.useState)(!1),[h,g]=(0,l.useState)("upload"),handleFileSelect=async e=>{var s;let t=null===(s=e.target.files)||void 0===s?void 0:s[0];if(!t)return;i(t),p(!0);let a=new FormData;a.append("file",t);try{let e=await d.Z.post("/api/upload/roster/preview",a);c(e.data.preview),m(e.data.preview.suggestions),g("map")}catch(e){alert("Failed to parse CSV file")}finally{p(!1)}},handleProcess=async()=>{if(!n||(u.studentId,0)){alert("Please map the Student ID column");return}p(!0);let e=new FormData;e.append("file",n),e.append("periodId",s),e.append("mapping",JSON.stringify(u));try{let s=await d.Z.post("/api/upload/roster/process",e);alert("Success! ".concat(s.data.inserted," students added, ").concat(s.data.skipped," duplicates skipped.")),t()}catch(e){var a,l;alert((null===(l=e.response)||void 0===l?void 0:null===(a=l.data)||void 0===a?void 0:a.error)||"Failed to process roster")}finally{p(!1)}},updateMapping=(e,s)=>{m({...u,[e]:s})};if("upload"===h)return(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Upload Student Roster"}),(0,a.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:[(0,a.jsx)("input",{type:"file",accept:".csv",onChange:handleFileSelect,className:"hidden",id:"csv-upload",disabled:x}),(0,a.jsxs)("label",{htmlFor:"csv-upload",className:"cursor-pointer",children:[(0,a.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),(0,a.jsxs)("p",{className:"mt-2 text-sm text-gray-600",children:[(0,a.jsx)("span",{className:"font-semibold",children:"Click to upload"})," or drag and drop"]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"CSV files only"})]})]}),(0,a.jsx)("button",{onClick:r,className:"mt-4 w-full px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"})]});if("map"===h&&o){var b,v,j,f,N;return(0,a.jsxs)("div",{className:"p-6 max-h-[80vh] overflow-y-auto",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Map CSV Columns"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Please confirm or adjust the column mappings below:"}),(0,a.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Student ID Column ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("select",{value:null!==(b=u.studentId)&&void 0!==b?b:"",onChange:e=>updateMapping("studentId",e.target.value?parseInt(e.target.value):void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[(0,a.jsx)("option",{value:"",children:"Select column..."}),o.headers.map((e,s)=>(0,a.jsxs)("option",{value:s,children:[e," (Column ",s+1,")"]},s))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name Format"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"radio",checked:void 0!==u.fullName,onChange:()=>{let e={...u};delete e.firstName,delete e.lastName,m(e)},className:"mr-2"}),(0,a.jsx)("span",{className:"text-sm",children:'Single "Full Name" column'})]}),(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"radio",checked:void 0===u.fullName,onChange:()=>{let e={...u};delete e.fullName,m(e)},className:"mr-2"}),(0,a.jsx)("span",{className:"text-sm",children:"Separate First/Last name columns"})]})]})]}),void 0!==u.fullName?(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name Column"}),(0,a.jsxs)("select",{value:null!==(v=u.fullName)&&void 0!==v?v:"",onChange:e=>updateMapping("fullName",e.target.value?parseInt(e.target.value):void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[(0,a.jsx)("option",{value:"",children:"Select column..."}),o.headers.map((e,s)=>(0,a.jsxs)("option",{value:s,children:[e," (Column ",s+1,")"]},s))]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"First Name Column"}),(0,a.jsxs)("select",{value:null!==(j=u.firstName)&&void 0!==j?j:"",onChange:e=>updateMapping("firstName",e.target.value?parseInt(e.target.value):void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[(0,a.jsx)("option",{value:"",children:"Select column..."}),o.headers.map((e,s)=>(0,a.jsxs)("option",{value:s,children:[e," (Column ",s+1,")"]},s))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Last Name Column"}),(0,a.jsxs)("select",{value:null!==(f=u.lastName)&&void 0!==f?f:"",onChange:e=>updateMapping("lastName",e.target.value?parseInt(e.target.value):void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[(0,a.jsx)("option",{value:"",children:"Select column..."}),o.headers.map((e,s)=>(0,a.jsxs)("option",{value:s,children:[e," (Column ",s+1,")"]},s))]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Column (Optional)"}),(0,a.jsxs)("select",{value:null!==(N=u.email)&&void 0!==N?N:"",onChange:e=>updateMapping("email",e.target.value?parseInt(e.target.value):void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[(0,a.jsx)("option",{value:"",children:"Select column..."}),o.headers.map((e,s)=>(0,a.jsxs)("option",{value:s,children:[e," (Column ",s+1,")"]},s))]})]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h4",{className:"font-medium mb-2",children:"Preview (First 5 rows)"}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsx)("tr",{children:o.headers.map((e,s)=>(0,a.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:e},s))})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:o.rows.map((e,s)=>(0,a.jsx)("tr",{children:e.map((e,s)=>(0,a.jsx)("td",{className:"px-3 py-2 whitespace-nowrap",children:e},s))},s))})]})})]}),(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsx)("button",{onClick:handleProcess,disabled:x||void 0===u.studentId,className:"flex-1 px-4 py-2 rounded-md font-medium ".concat(x||void 0===u.studentId?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),children:x?"Processing...":"Import Students"}),(0,a.jsx)("button",{onClick:r,className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"})]})]})}return null}function CreatePeriodDialog(e){let{onSuccess:s,onCancel:t}=e,[r,n]=(0,l.useState)(""),[i,o]=(0,l.useState)(""),[c,u]=(0,l.useState)(!1),[m,x]=(0,l.useState)(""),handleSubmit=async e=>{e.preventDefault(),x("");let t=parseInt(i);if(!t||t<1||t>10){x("Period number must be between 1 and 10");return}u(!0);try{await d.Z.post("/api/periods",{name:r||"Period ".concat(t),periodNumber:t}),s()}catch(e){var a,l;x((null===(l=e.response)||void 0===l?void 0:null===(a=l.data)||void 0===a?void 0:a.error)||"Failed to create period")}finally{u(!1)}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Create New Period"}),(0,a.jsxs)("form",{onSubmit:handleSubmit,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Period Number ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"number",value:i,onChange:e=>o(e.target.value),min:"1",max:"10",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., 1",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Period Name (Optional)"}),(0,a.jsx)("input",{type:"text",value:r,onChange:e=>n(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Period 1 - Math"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:'Leave blank to use default "Period X" format'})]}),m&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:m}),(0,a.jsxs)("div",{className:"flex space-x-3 pt-4",children:[(0,a.jsx)("button",{type:"submit",disabled:c||!i,className:"flex-1 px-4 py-2 rounded-md font-medium ".concat(c||!i?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),children:c?"Creating...":"Create Period"}),(0,a.jsx)("button",{type:"button",onClick:t,className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"})]})]})]})})}function RosterPage(){let e=(0,r.useRouter)(),[s,t]=(0,l.useState)(!1),[i,o]=(0,l.useState)(!1),[c,u]=(0,l.useState)(""),{data:m,loading:x,error:p,refetch:h}=(0,n.h)("/api/periods"),handleUploadClick=e=>{u(e),t(!0)},deletePeriod=async(e,s)=>{if(confirm("Are you sure you want to delete ".concat(s,"? This will also remove all students in this period.")))try{await d.Z.delete("/api/periods/".concat(e)),h()}catch(e){var t,a;alert((null===(a=e.response)||void 0===a?void 0:null===(t=a.data)||void 0===t?void 0:t.error)||"Failed to delete period")}};return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("div",{className:"bg-white shadow",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-4",children:[(0,a.jsx)("button",{onClick:()=>e.push("/autograde"),className:"text-blue-600 hover:text-blue-800 mb-4",children:"← Back to Dashboard"}),(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Manage Class Rosters"})]})}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[s&&(0,a.jsx)(CSVUploader,{periodId:c,onSuccess:()=>{t(!1),u(""),h()},onCancel:()=>t(!1)}),i&&(0,a.jsx)(CreatePeriodDialog,{onSuccess:()=>{o(!1),h()},onCancel:()=>o(!1)}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,a.jsxs)("div",{className:"px-6 py-4 border-b flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Class Periods"}),(0,a.jsx)("button",{onClick:()=>o(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Add Period"})]}),(0,a.jsx)("div",{className:"divide-y",children:x?(0,a.jsx)("div",{className:"px-6 py-8 text-center",children:"Loading..."}):p?(0,a.jsxs)("div",{className:"px-6 py-8 text-center text-red-600",children:["Error: ",p]}):(null==m?void 0:m.length)===0?(0,a.jsxs)("div",{className:"px-6 py-8 text-center text-gray-500",children:[(0,a.jsx)("p",{className:"mb-4",children:"No periods created yet."}),(0,a.jsx)("button",{onClick:()=>o(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Create Your First Period"})]}):null==m?void 0:m.map(s=>(0,a.jsx)("div",{className:"px-6 py-4 hover:bg-gray-50",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium text-lg",children:s.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[s.studentCount," ",1===s.studentCount?"student":"students"]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("button",{onClick:()=>handleUploadClick(s._id),className:"px-3 py-1 bg-green-100 text-green-700 rounded-md hover:bg-green-200 text-sm",children:"Upload CSV"}),(0,a.jsx)("button",{onClick:()=>e.push("/autograde/roster/".concat(s._id)),className:"px-3 py-1 bg-blue-100 text-blue-700 rounded-md hover:bg-blue-200 text-sm",children:"View Students"}),(0,a.jsx)("button",{onClick:()=>deletePeriod(s._id,s.name),className:"px-3 py-1 bg-red-100 text-red-700 rounded-md hover:bg-red-200 text-sm",children:"Delete"})]})]})},s._id))})]}),(0,a.jsxs)("div",{className:"mt-8 bg-blue-50 rounded-lg p-6",children:[(0,a.jsx)("h3",{className:"font-semibold text-blue-900 mb-2",children:"Getting Started"}),(0,a.jsxs)("ol",{className:"list-decimal list-inside text-blue-800 text-sm space-y-2",children:[(0,a.jsx)("li",{children:"Create periods for each of your classes (e.g., Period 1, Period 2)"}),(0,a.jsx)("li",{children:"Upload a CSV file with student information for each period"}),(0,a.jsx)("li",{children:"The system will automatically detect student IDs and names from your CSV"}),(0,a.jsx)("li",{children:"You can then generate grade sheets for assignments"})]})]}),(0,a.jsxs)("div",{className:"mt-4 bg-gray-50 rounded-lg p-6",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 mb-2",children:"CSV File Format"}),(0,a.jsx)("p",{className:"text-gray-700 text-sm mb-3",children:"Your CSV file should have columns for:"}),(0,a.jsxs)("ul",{className:"list-disc list-inside text-gray-700 text-sm space-y-1",children:[(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Student ID"})," - Unique identifier (required)"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Name"}),' - Either "First Name" & "Last Name" or single "Name" column']}),(0,a.jsxs)("li",{children:[(0,a.jsx)("strong",{children:"Email"})," - Student email (optional)"]})]}),(0,a.jsx)("div",{className:"mt-3 bg-white p-3 rounded border border-gray-200",children:(0,a.jsxs)("p",{className:"text-xs font-mono text-gray-600",children:["Example:",(0,a.jsx)("br",{}),"Student ID,First Name,Last Name,Email",(0,a.jsx)("br",{}),"12345,John,Smith,john.smith@school.edu",(0,a.jsx)("br",{}),"12346,Jane,Doe,jane.doe@school.edu"]})})]})]})]})}},5606:function(e,s,t){"use strict";t.d(s,{h:function(){return useApi}});var a=t(2265),l=t(4501),r=t(4033);function useApi(e){let[s,t]=(0,a.useState)(null),[n,d]=(0,a.useState)(!0),[i,o]=(0,a.useState)(null),c=(0,r.useRouter)();(0,a.useEffect)(()=>{if(!e)return;let fetchData=async()=>{try{d(!0);let s=await l.Z.get(e);t(s.data),o(null)}catch(e){var s;o(e.message||"An error occurred"),(null===(s=e.response)||void 0===s?void 0:s.status)===401&&c.push("/login")}finally{d(!1)}};fetchData()},[e,c]);let refetch=async()=>{if(e){d(!0);try{let s=await l.Z.get(e);t(s.data),o(null)}catch(e){o(e.message||"An error occurred")}finally{d(!1)}}};return{data:s,loading:n,error:i,refetch}}},4501:function(e,s,t){"use strict";var a=t(4829),l=t(2749);let r=a.Z.create({baseURL:"https://api.growwithpraxis.com",headers:{"Content-Type":"application/json"}});r.interceptors.request.use(async e=>{try{let t=await (0,l.getSession)();if(t){var s;e.headers.Authorization="Bearer ".concat((null===(s=t.user)||void 0===s?void 0:s.email)||"test-token")}}catch(e){console.error("Error getting session:",e)}return e}),r.interceptors.response.use(e=>e,e=>{var s,t;return console.error("API Error:",(null===(s=e.response)||void 0===s?void 0:s.data)||e.message),(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(window.location.href="/login"),Promise.reject(e)}),s.Z=r},4033:function(e,s,t){e.exports=t(94)}},function(e){e.O(0,[749,829,971,472,744],function(){return e(e.s=8809)}),_N_E=e.O()}]);