(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[719],{2863:function(e,t,s){Promise.resolve().then(s.bind(s,1147))},1147:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return StudentManagementPage}});var a=s(7437),l=s(2265),n=s(4033),r=s(5606),d=s(4501);function StudentManagementPage(){let e=(0,n.useRouter)(),t=(0,n.useParams)(),s=null==t?void 0:t.periodId,[i,o]=(0,l.useState)(new Set),[c,u]=(0,l.useState)(!1),[x,m]=(0,l.useState)(!1),[h,p]=(0,l.useState)(null),{data:g,loading:b}=(0,r.h)("/api/periods/".concat(s)),{data:f,loading:y,refetch:v}=(0,r.h)("/api/students/period/".concat(s)),{data:N}=(0,r.h)("/api/periods"),toggleStudent=e=>{let t=new Set(i);t.has(e)?t.delete(e):t.add(e),o(t)},deleteSelected=async()=>{if(confirm("Delete ".concat(i.size," student(s)?")))try{for(let e of Array.from(i))await d.Z.delete("/api/students/".concat(e));o(new Set),v()}catch(e){alert("Failed to delete students")}};return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("div",{className:"bg-white shadow",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-4",children:[(0,a.jsx)("button",{onClick:()=>e.push("/autograde/roster"),className:"text-blue-600 hover:text-blue-800 mb-4",children:"← Back to Periods"}),(0,a.jsxs)("h1",{className:"text-2xl font-bold",children:[(null==g?void 0:g.name)||"Loading..."," - Student Management"]})]})}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[(0,a.jsx)("div",{className:"bg-white rounded-lg shadow mb-6 p-4",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("div",{className:"flex items-center space-x-4",children:i.size>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:[i.size," selected"]}),(0,a.jsx)("button",{onClick:deleteSelected,className:"px-3 py-1 bg-red-100 text-red-700 rounded-md hover:bg-red-200 text-sm",children:"Delete Selected"}),(0,a.jsx)("button",{onClick:()=>m(!0),className:"px-3 py-1 bg-blue-100 text-blue-700 rounded-md hover:bg-blue-200 text-sm",children:"Move to Period"})]})}),(0,a.jsx)("button",{onClick:()=>u(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Add Student"})]})}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left",children:(0,a.jsx)("input",{type:"checkbox",checked:i.size===(null==f?void 0:f.length)&&(null==f?void 0:f.length)>0,onChange:()=>{i.size===(null==f?void 0:f.length)?o(new Set):o(new Set((null==f?void 0:f.map(e=>e._id))||[]))},className:"rounded border-gray-300"})}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Student ID"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:y?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:5,className:"px-6 py-8 text-center",children:"Loading..."})}):(null==f?void 0:f.length)===0?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:5,className:"px-6 py-8 text-center text-gray-500",children:"No students in this period yet."})}):null==f?void 0:f.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsx)("input",{type:"checkbox",checked:i.has(e._id),onChange:()=>toggleStudent(e._id),className:"rounded border-gray-300"})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.studentId}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.firstName," ",e.lastName]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.email||"-"}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:[(0,a.jsx)("button",{onClick:()=>p(e),className:"text-blue-600 hover:text-blue-800 mr-3",children:"Edit"}),(0,a.jsx)("button",{onClick:async()=>{confirm("Delete this student?")&&(await d.Z.delete("/api/students/".concat(e._id)),v())},className:"text-red-600 hover:text-red-800",children:"Delete"})]})]},e._id))})]})}),c&&(0,a.jsx)(AddStudentDialog,{periodId:s,onSuccess:()=>{u(!1),v()},onCancel:()=>u(!1)}),h&&(0,a.jsx)(EditStudentDialog,{student:h,onSuccess:()=>{p(null),v()},onCancel:()=>p(null)}),x&&(0,a.jsx)(MoveStudentsDialog,{selectedStudents:Array.from(i),currentPeriodId:s,periods:(null==N?void 0:N.filter(e=>e._id!==s))||[],onSuccess:()=>{m(!1),o(new Set),v()},onCancel:()=>m(!1)})]})]})}function AddStudentDialog(e){let{periodId:t,onSuccess:s,onCancel:n}=e,[r,i]=(0,l.useState)({studentId:"",firstName:"",lastName:"",email:""}),[o,c]=(0,l.useState)(!1),handleSubmit=async e=>{e.preventDefault(),c(!0);try{await d.Z.post("/api/students",{...r,periodId:t}),s()}catch(e){var a,l;alert((null===(l=e.response)||void 0===l?void 0:null===(a=l.data)||void 0===a?void 0:a.error)||"Failed to add student")}finally{c(!1)}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Add New Student"}),(0,a.jsxs)("form",{onSubmit:handleSubmit,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Student ID ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",value:r.studentId,onChange:e=>i({...r,studentId:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["First Name ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",value:r.firstName,onChange:e=>i({...r,firstName:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Last Name ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",value:r.lastName,onChange:e=>i({...r,lastName:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email (Optional)"}),(0,a.jsx)("input",{type:"email",value:r.email,onChange:e=>i({...r,email:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{className:"flex space-x-3 pt-4",children:[(0,a.jsx)("button",{type:"submit",disabled:o,className:"flex-1 px-4 py-2 rounded-md font-medium ".concat(o?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),children:o?"Adding...":"Add Student"}),(0,a.jsx)("button",{type:"button",onClick:n,className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"})]})]})]})})}function EditStudentDialog(e){let{student:t,onSuccess:s,onCancel:n}=e,[r,i]=(0,l.useState)({firstName:t.firstName,lastName:t.lastName,email:t.email||""}),[o,c]=(0,l.useState)(!1),handleSubmit=async e=>{e.preventDefault(),c(!0);try{await d.Z.put("/api/students/".concat(t._id),r),s()}catch(e){var a,l;alert((null===(l=e.response)||void 0===l?void 0:null===(a=l.data)||void 0===a?void 0:a.error)||"Failed to update student")}finally{c(!1)}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Edit Student"}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mb-4",children:["Student ID: ",t.studentId]}),(0,a.jsxs)("form",{onSubmit:handleSubmit,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["First Name ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",value:r.firstName,onChange:e=>i({...r,firstName:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Last Name ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",value:r.lastName,onChange:e=>i({...r,lastName:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,a.jsx)("input",{type:"email",value:r.email,onChange:e=>i({...r,email:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{className:"flex space-x-3 pt-4",children:[(0,a.jsx)("button",{type:"submit",disabled:o,className:"flex-1 px-4 py-2 rounded-md font-medium ".concat(o?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),children:o?"Saving...":"Save Changes"}),(0,a.jsx)("button",{type:"button",onClick:n,className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"})]})]})]})})}function MoveStudentsDialog(e){let{selectedStudents:t,currentPeriodId:s,periods:n,onSuccess:r,onCancel:i}=e,[o,c]=(0,l.useState)(""),[u,x]=(0,l.useState)(!1),handleMove=async()=>{if(!o){alert("Please select a target period");return}x(!0);try{await d.Z.post("/api/students/move",{studentIds:t,fromPeriodId:s,toPeriodId:o}),r()}catch(t){var e,a;alert((null===(a=t.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.error)||"Failed to move students")}finally{x(!1)}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Move Students"}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mb-4",children:["Moving ",t.length," student(s) to another period."]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Target Period"}),(0,a.jsxs)("select",{value:o,onChange:e=>c(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"",children:"Choose a period..."}),n.map(e=>(0,a.jsx)("option",{value:e._id,children:e.name},e._id))]})]}),(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsx)("button",{onClick:handleMove,disabled:u||!o,className:"flex-1 px-4 py-2 rounded-md font-medium ".concat(u||!o?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"),children:u?"Moving...":"Move Students"}),(0,a.jsx)("button",{type:"button",onClick:i,className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"})]})]})})}},5606:function(e,t,s){"use strict";s.d(t,{h:function(){return useApi}});var a=s(2265),l=s(4501),n=s(4033);function useApi(e){let[t,s]=(0,a.useState)(null),[r,d]=(0,a.useState)(!0),[i,o]=(0,a.useState)(null),c=(0,n.useRouter)();(0,a.useEffect)(()=>{if(!e)return;let fetchData=async()=>{try{d(!0);let t=await l.Z.get(e);s(t.data),o(null)}catch(e){var t;o(e.message||"An error occurred"),(null===(t=e.response)||void 0===t?void 0:t.status)===401&&c.push("/login")}finally{d(!1)}};fetchData()},[e,c]);let refetch=async()=>{if(e){d(!0);try{let t=await l.Z.get(e);s(t.data),o(null)}catch(e){o(e.message||"An error occurred")}finally{d(!1)}}};return{data:t,loading:r,error:i,refetch}}},4501:function(e,t,s){"use strict";var a=s(4829),l=s(2749);let n=a.Z.create({baseURL:"https://api.growwithpraxis.com",headers:{"Content-Type":"application/json"}});n.interceptors.request.use(async e=>{try{let s=await (0,l.getSession)();if(s){var t;e.headers.Authorization="Bearer ".concat((null===(t=s.user)||void 0===t?void 0:t.email)||"test-token")}}catch(e){console.error("Error getting session:",e)}return e}),n.interceptors.response.use(e=>e,e=>{var t,s;return console.error("API Error:",(null===(t=e.response)||void 0===t?void 0:t.data)||e.message),(null===(s=e.response)||void 0===s?void 0:s.status)===401&&(window.location.href="/login"),Promise.reject(e)}),t.Z=n},4033:function(e,t,s){e.exports=s(94)}},function(e){e.O(0,[749,829,971,472,744],function(){return e(e.s=2863)}),_N_E=e.O()}]);